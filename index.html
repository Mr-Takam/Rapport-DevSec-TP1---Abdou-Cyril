<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rapport d'Audit de S√©curit√© - Efrei Paris</title>
    
    <link rel="icon" 
          type="image/svg+xml" 
          href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üõ°Ô∏è</text></svg>">
    
    <style>
      /* --- CONFIGURATION GLOBALE --- */
        :root {
            --primary-color: #003b7e; /* Bleu Efrei approximatif */
            --secondary-color: #009fe3; /* Bleu clair */
            --accent-color: #e63946; /* Rouge pour les alertes */
            --text-color: #333;
            --light-bg: #f4f7f6;
            --code-bg: #2d2d2d;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            margin: 0;
            padding: 0;
            background-color: #fff;
        }

        /* --- PAGE DE GARDE --- */
        .cover-page {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background: linear-gradient(135deg, var(--primary-color) 0%, #001f4d 100%);
            color: white;
            padding: 2rem;
        }

        .school-name {
            font-size: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 2rem;
            font-weight: bold;
        }

        .report-title {
            font-size: 3.5rem;
            color: #009fe3;
            margin: 0;
            line-height: 1.2;
            font-weight: 700;
        }

        .report-subtitle {
            font-size: 1.8rem;
            color: #009fe3;
            margin-top: 1rem;
            font-weight: 300;
            opacity: 0.55;
        }

        /* Remplacer l'ancien .authors-box par ceci : */
        .authors-box {
            margin-top: 4rem;
            background: rgba(255, 255, 255, 0.1); /* Effet verre */
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            
            /* Nouvelle disposition Flexbox */
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 0; /* Le padding est g√©r√© par les colonnes */
            width: 100%;
            max-width: 800px; /* Largeur contenue pour l'esth√©tique */
            text-align: left; /* Important : on aligne le texte √† gauche dans les boites */
        }

        /* Nouveaux styles pour les colonnes */
        .box-col {
            flex: 1;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .left-col {
            border-right: 1px solid rgba(255, 255, 255, 0.3); /* Ligne de s√©paration */
        }

        .meta-group {
            margin-bottom: 1.5rem;
        }
        .meta-group:last-child {
            margin-bottom: 0;
        }

        /* Styles typographiques pour les labels et valeurs */
        .label {
            display: block;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .value {
            display: block;
            font-size: 1.2rem;
            font-weight: 500;
            color: #fff;
            margin-bottom: 0.2rem;
        }

        /* --- STRUCTURE DU CONTENU --- */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 4rem 2rem;
        }

        h1 {
            color: var(--primary-color);
            border-bottom: 3px solid var(--secondary-color);
            padding-bottom: 0.5rem;
            margin-top: 3rem;
            page-break-before: always; /* Saut de page avant chaque grand titre */
        }
        
        h1:first-of-type {
            page-break-before: auto;
        }

        h2 {
            color: var(--primary-color);
            margin-top: 2rem;
            border-left: 5px solid var(--secondary-color);
            padding-left: 1rem;
        }

        h3 {
            color: #444;
            margin-top: 1.5rem;
        }

        /* --- SOMMAIRE --- */
        .toc {
            background-color: var(--light-bg);
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 4rem;
        }
        .toc ul { list-style-type: none; padding-left: 0; }
        .toc li { margin-bottom: 0.5rem; border-bottom: 1px dashed #ccc; }
        .toc a { text-decoration: none; color: var(--primary-color); font-weight: 600; display: flex; justify-content: space-between; }

        /* Style pour les sous-sections du sommaire */
        .sub-toc {
            padding-left: 20px !important;
            font-size: 0.95rem;
            border-bottom: 1px dotted #e0e0e0 !important; /* Trait plus discret pour les sous-items */
        }

        .sub-toc a {
            font-weight: 400 !important; /* Texte normal, pas gras */
            color: #555 !important;
        }
        /* --- COMPOSANTS SP√âCIFIQUES --- */
        
        /* Matrice de Risque (Style Tableau) */
        .risk-matrix-placeholder {
            width: 100%;
            border-collapse: collapse;
            margin: 2rem 0;
            text-align: center;
        }
        .risk-matrix-placeholder th, .risk-matrix-placeholder td {
            border: 1px solid #ddd;
            padding: 10px;
        }
        .risk-high { background-color: #ffcccc; color: #a00; font-weight: bold; }
        .risk-med { background-color: #fff4cc; color: #996600; }
        .risk-low { background-color: #ccffcc; color: #006600; }

        /* Boite de Vuln√©rabilit√© */
        .vuln-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 2rem;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .vuln-header {
            background-color: #f8f9fa;
            padding: 1rem;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .severity-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
            color: white;
        }
        .sev-critical { background-color: #d90429; }
        .sev-high { background-color: #fb8500; }
        .sev-medium { background-color: #ffb703; color: #333; }

        .vuln-content {
            padding: 1.5rem;
        }

        /* Captures d'√©cran */
        .screenshot-box {
            background-color: #eee;
            border: 2px dashed #aaa;
            color: #666;
            padding: 2rem;
            text-align: center;
            margin: 1rem 0;
            border-radius: 4px;
        }
        .screenshot-box img {
            max-width: 100%;
            height: auto;
            border: 1px solid #ccc;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .caption {
            font-style: italic;
            font-size: 0.9rem;
            color: #666;
            text-align: center;
            display: block;
            margin-top: 0.5rem;
        }

        /* Code Source */
        pre {
            background-color: var(--code-bg);
            color: #f8f8f2;
            padding: 1rem;
            border-radius: 5px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
        }

        /* Notes importantes */
        .info-box {
            background-color: #e7f5ff;
            border-left: 4px solid var(--secondary-color);
            padding: 1rem;
            margin: 1rem 0;
        }

        /* --- PRINT MEDIA QUERIES --- */
        @media print {
            body { background-color: #fff; }
            .cover-page { height: 100vh; background: white; color: black; }
            .cover-page h1 { color: black; }
            .authors-box { background: none; border: 1px solid #000; color: black; }
            .toc { background: none; border: 1px solid #ccc; }
        }
    </style>
</head>
<body>
    
    <div class="cover-page">
        <div class="school-name">EFREI PARIS - Universit√© Paris Panth√©on-Assas</div>
        <h1 class="report-title">Audit de S√©curit√© Applicatif</h1>
        <h2 class="report-subtitle">Application Bancaire JavaEE</h2>
        
        <div class="authors-box">
            <div class="box-col left-col">
                <span class="label">Auteurs</span>
                <span class="value">Cyril TAKAM</span>
                <span class="value">Abdou Khadre DIOP</span>
            </div>
            <div class="box-col right-col">
                <div class="meta-group">
                    <span class="label">Date</span>
                    <span class="value">Novembre 2025</span>
                </div>
                <div class="meta-group">
                    <span class="label">Module</span>
                    <span class="value">D√©veloppement S√©curis√© - Ing√© 3</span>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        
        <div class="toc">
            <h2>Sommaire</h2>
            <ul>
                <li><a href="#intro">1. Pr√©sentation de la Cible & Contexte</a></li>
                <li class="sub-toc"><a href="#intro-fonc">1.1 Description Fonctionnelle</a></li>
                <li class="sub-toc"><a href="#intro-tech">1.2 Architecture & Stack Technique</a></li>
                <li class="sub-toc"><a href="#intro-uml">1.3 Mod√©lisation UML (Classes & S√©quences)</a></li>

                <li><a href="#methodo">2. D√©marche d'Audit et Outils Utilis√©s</a></li>
                <li class="sub-toc"><a href="#methodo-static">2.1 Analyse Statique (Code Review)</a></li>
                <li class="sub-toc"><a href="#methodo-dynamic">2.2 Tests d'Intrusion Dynamiques (Pentest)</a></li>
                <li class="sub-toc"><a href="#methodo-auto">2.3 Scans Automatis√©s (OWASP ZAP)</a></li>

                <li><a href="#synthese">3. Synth√®se Manag√©riale (Executive Summary)</a></li>
                <li class="sub-toc"><a href="#risk-matrix">3.1 Matrice des Risques</a></li>
                <li class="sub-toc"><a href="#global-rating">3.2 √âvaluation Globale de S√©curit√©</a></li>

                <li><a href="#details">4. Analyse D√©taill√©e des Vuln√©rabilit√©s</a></li>
                <li class="sub-toc"><a href="#vuln-sqli">4.1 Injection SQL (SQLi)</a></li>
                <li class="sub-toc"><a href="#vuln-rce">4.2 Injection de Code (RCE)</a></li>
                <li class="sub-toc"><a href="#vuln-access">4.3 Contr√¥le d'Acc√®s Insuffisant (IDOR/BAC)</a></li>
                <li class="sub-toc"><a href="#vuln-auth">4.4 Authentification Faible & Rate Limiting</a></li>
                <li class="sub-toc"><a href="#vuln-xss">4.5 Cross-Site Scripting (XSS)</a></li>
                <li class="sub-toc"><a href="#vuln-csrf">4.6 Absence de protection CSRF</a></li>
                <li class="sub-toc"><a href="#vuln-others">4.7 Exposition de Donn√©es Sensibles (Config/Logs)</a></li>
                <li class="sub-toc"><a href="#vuln-input">4.8 Validation d'Entr√©e Insuffisante</a></li>

                <li><a href="#reco">5. Plan de Rem√©diation et Recommandations</a></li>
                
                <li><a href="#conclu">6. Conclusion G√©n√©rale</a></li>
            </ul>
        </div>

        <h1 id="intro">1. Pr√©sentation de la Cible & Contexte</h1>
        <p>
            L'application audit√©e, intitul√©e <em>tp1-banque-unsecured-v0</em>, est une plateforme bancaire d√©monstrative con√ßue sur une architecture JavaEE. 
            Elle simule des op√©rations bancaires basiques (consultation de solde, virements) et gestion d'utilisateurs avec une s√©gr√©gation des droits (RBAC).
        </p>
        <p>
            L'audit vise √† √©valuer la robustesse de cette application face aux vecteurs d'attaques standards (OWASP Top 10), en consid√©rant son √©tat actuel "Non S√©curis√©" (v0).
        </p>

        <h2 id="intro-fonc">1.1 Description Fonctionnelle</h2>
        <p>
            L'application g√®re deux niveaux de privil√®ges distincts, identifi√©s dans le code via le cookie <code>ClientRole</code> :
        </p>
        <ul>
            <li><strong>R√¥le CLIENT :</strong> Permet l'authentification, la consultation de ses propres comptes et l'ex√©cution de virements (cr√©dit/d√©bit) via une expression arithm√©tique.</li>
            <li><strong>R√¥le ADMIN :</strong> Dispose des droits √©tendus incluant la cr√©ation de nouveaux comptes bancaires et la vision globale sur l'ensemble des comptes clients (recherche par ID ou email).</li>
        </ul>

        <h2 id="intro-tech">1.2 Architecture & Stack Technique</h2>
        <p>
            L'analyse du fichier <code>pom.xml</code> et du code source r√©v√®le une architecture MVC (Mod√®le-Vue-Contr√¥leur) "Raw" (sans framework de haut niveau type Spring), reposant sur les technologies suivantes :
        </p>
        
        <table class="risk-matrix-placeholder" style="text-align: left;">
            <tr>
                <td style="background: #f4f7f6; font-weight: bold; width: 30%;">Langage & Runtime</td>
                <td>Java 21 (OpenJDK)</td>
            </tr>
            <tr>
                <td style="background: #f4f7f6; font-weight: bold;">Serveur d'Application</td>
                <td>Apache Tomcat 11.x (Jakarta EE 6.0 Servlet API)</td>
            </tr>
            <tr>
                <td style="background: #f4f7f6; font-weight: bold;">Persistance</td>
                <td>JDBC pur (MySQL Connector 8.3.0) sans ORM. Connexion directe √† MySQL via <code>DriverManager</code>.</td>
            </tr>
            <tr>
                <td style="background: #f4f7f6; font-weight: bold;">Frontend</td>
                <td>JSP (JavaServer Pages) avec JSTL 3.0.</td>
            </tr>
            <tr>
                <td style="background: #f4f7f6; font-weight: bold;">Composant Critique</td>
                <td><strong>Nashorn Script Engine</strong> (<code>org.openjdk.nashorn</code> v15.6) utilis√© pour le calcul des transactions.</td>
            </tr>
        </table>

        <h2 id="intro-uml">1.3 Mod√©lisation UML</h2>
        <p>
            Conform√©ment aux exigences du livrable, la mod√©lisation de l'application a √©t√© structur√©e en trois vues distinctes. Cette segmentation permet de mieux appr√©hender les responsabilit√©s de chaque couche (Mod√®le, Persistance, Contr√¥leur) et d'identifier plus facilement les points d'int√©gration critiques pour la s√©curit√©.
        </p>
        
        <h3 id="uml-model">1.3.1. Mod√®le et Logique M√©tier (C≈ìur de la Banque)</h3>
        <p>
            Ce diagramme met en √©vidence les entit√©s de base (<code>User</code>, <code>Account</code>) et la logique m√©tier centralis√©e. La classe <code>Bank</code> utilise le patron <strong>Singleton</strong> et expose les m√©thodes fonctionnelles, notamment la transaction bancaire <code>updateBankAccount</code>, qui s'av√®rera critique pour l'Injection de Code.
        </p>
        <div class="screenshot-box">
            <img src="https://i.postimg.cc/JznqN9ng/Mermaid_1.png" alt="Diagramme de classes UML du Mod√®le">
        </div>
        <span class="caption">Figure 1a : Mod√©lisation des classes de donn√©es et de la logique m√©tier (`model`).</span>
        
        <br>
        
        <h3 id="uml-persistence">1.3.2. Couche de Persistance (Pattern DAO)</h3>
        <p>
            Cette vue se concentre sur le patron <strong>DAO (Data Access Object)</strong> impl√©ment√© via l'interface <code>IPersistence</code> et son impl√©mentation concr√®te <code>JdbcMySQLMainPersistence</code>. Elle montre l'isolement entre le c≈ìur de l'application et la base de donn√©es. Tous les appels SQL transitent par ces classes, qui sont le point n√©vralgique des vuln√©rabilit√©s d'Injection SQL.
        </p>
        <div class="screenshot-box">
            <img src="https://i.postimg.cc/4xd56rdj/Mermaid_2.png" alt="Diagramme de classes UML de la Persistance">
        </div>
        <span class="caption">Figure 1b : Mod√©lisation de la couche d'acc√®s aux donn√©es (`persistence`).</span>
        
        <br>
        
        <h3 id="uml-controller">1.3.3. Couche Contr√¥leur et S√©curit√©</h3>
        <p>
            Cette derni√®re vue pr√©sente la couche de pr√©sentation (les Servlets, ou <strong>Contr√¥leurs</strong>) et l'int√©gration des m√©canismes de s√©curit√© rudimentaires (classe <code>Authentication</code>). Elle illustre comment l'autorisation est g√©r√©e dans chaque Servlets via <code>getAuthorization</code>, et montre l'usage des exceptions sp√©cifiques (<code>UserAthorizationException</code>) en cas de violation d'acc√®s.
        </p>
        <div class="screenshot-box">
            <img src="https://i.postimg.cc/5203BZ0R/Mermaid_3.png" alt="Diagramme de classes UML des Contr√¥leurs et S√©curit√©">
        </div>
        <span class="caption">Figure 1c : Mod√©lisation de la couche contr√¥leur (`controllers`) et de s√©curit√©.</span>

        <h1 id="methodo">2. D√©marche d'Audit et Outils Utilis√©s</h1>
        <p>
            L'audit de s√©curit√© a √©t√© men√© en se basant sur la m√©thodologie des tests d'intrusion de l'OWASP Testing Guide (v4/v5), combinant rigueur statique et validation dynamique pour couvrir l'ensemble du p√©rim√®tre applicatif.
        </p>

        <h2 id="methodo-static">2.1 Analyse Statique (Code Review)</h2>
        <p>
            Cette phase, r√©alis√©e en mode <strong>Bo√Æte Blanche</strong> a consist√© √† inspecter manuellement les fichiers Java et JSP critiques afin d'identifier les anti-patterns de s√©curit√© (Code smells) :
            <ul>
                <li><strong>Recherche d'Injection :</strong> Concat√©nation de cha√Ænes SQL ou usage de fonctions d'√©valuation dynamique (e.g., <code>ScriptEngine.eval()</code> dans <code>model/Bank.java</code>).</li>
                <li><strong>Contr√¥le d'Acc√®s :</strong> Examen des Servlets (e.g., <code>TransactionServlet</code>) pour l'absence de v√©rification d'autorisation ou l'usage de cookies clients modifiables pour le r√¥le.</li>
                <li><strong>Exposition de Donn√©es :</strong> Identification des identifiants de connexion cod√©s en dur et des sorties non encod√©es (e.g., dans <code>view_accounts.jsp</code>).</li>
            </ul>
        </p>

        <h2 id="methodo-dynamic">2.2 Tests d'Intrusion Dynamiques (Pentest)</h2>
        <p>
            Cette phase a valid√© l'exploitabilit√© des failles d√©couvertes statiquement et a cherch√© des vuln√©rabilit√©s suppl√©mentaires en conditions r√©elles.
        </p>

        <h3 id="methodo-manual">2.2.1 Tests Manuels (Bo√Æte Noire & Blanche)</h3>
        <p>
            Les tests manuels ont √©t√© conduits selon deux modes :
            <ul>
                <li><strong>Bo√Æte Noire</strong> : Simulation d'un attaquant externe n'ayant aucune connaissance du code. Cibl√©e sur la d√©couverte des XSS et la tentative de contournement des contr√¥les d'authentification/session (rate limiting).</li>
                <li><strong>Bo√Æte Blanche</strong> : R√©alisation d'attaques cibl√©es, guid√©es par la revue de code, pour confirmer l'exploitabilit√© des Injections SQL et de Code sur les points pr√©cis identifi√©s dans la couche de persistance et le mod√®le.</li>
            </ul>
        </p>
        
        <h3 id="methodo-auto">2.2.2 Scans Automatis√©s (OWASP ZAP)</h3>
        <p>
            L'outil <strong>OWASP ZAP</strong> (Zed Attack Proxy) a √©t√© utilis√© pour le scanning automatis√©, couvrant l'exploration des pages (Spider) et la recherche proactive de vuln√©rabilit√©s (Active Scan). Les r√©sultats de ZAP ont permis de confirmer la pr√©sence des failles Reflected XSS et le manque de protection CSRF, renfor√ßant les conclusions de l'analyse manuelle.
        </p>

        <h1 id="synthese">3. Synth√®se Manag√©riale (Executive Summary)</h1>
        <p>
            Cette section pr√©sente une vue d'ensemble des risques identifi√©s dans l'application <code>tp1-banque-unsecured-v0</code>. L'√©valuation est bas√©e sur le croisement de l'<strong>Impact</strong> (cons√©quences de l'exploitation) et de la <strong>Probabilit√©</strong> (facilit√© d'exploitation) pour d√©terminer le niveau de risque g√©n√©ral.
        </p>

        <h2 id="risk-matrix">3.1 Matrice des Risques</h2>
        <p>
            Le tableau ci-dessous r√©capitule les huit vuln√©rabilit√©s d√©couvertes, class√©es selon leur criticit√© (CVSS / Risque final) :
        </p>

        <table class="risk-matrix-placeholder">
            <thead>
                <tr>
                    <th style="width: 5%;">ID</th>
                    <th style="width: 30%;">Vuln√©rabilit√©</th>
                    <th style="width: 15%;">OWASP Top 10</th>
                    <th style="width: 15%;">S√©v√©rit√© (CVSS)</th>
                    <th style="width: 15%;">Probabilit√©</th>
                    <th style="width: 20%;">Niveau de Risque</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td>Injection SQL (SQLi)</td>
                    <td>A03: Injection</td>
                    <td>Critique (9.8)</td>
                    <td>√âlev√©e</td>
                    <td class="risk-high">CRITIQUE</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>Injection de Code (RCE via Nashorn)</td>
                    <td>A03: Injection</td>
                    <td>Critique (9.1)</td>
                    <td>√âlev√©e</td>
                    <td class="risk-high">CRITIQUE</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>Contr√¥le d'Acc√®s Insuffisant (ABAC / IDOR)</td>
                    <td>A01: Broken Access Control</td>
                    <td>Critique (9.1)</td>
                    <td>√âlev√©e</td>
                    <td class="risk-high">CRITIQUE</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>Authentification Faible (Mots de passe en clair / Rate Limit C√¥t√© Client)</td>
                    <td>A07: Identification Failures</td>
                    <td>√âlev√© (7.5)</td>
                    <td>Moyenne</td>
                    <td class="risk-med">√âLEV√â</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>Cross-Site Scripting (XSS Stored/Reflected)</td>
                    <td>A03: Injection</td>
                    <td>Moyen (6.1)</td>
                    <td>√âlev√©e</td>
                    <td class="risk-med">√âLEV√â</td>
                </tr>
                <tr>
                    <td>6</td>
                    <td>Absence de protection CSRF</td>
                    <td>A01: Broken Access Control</td>
                    <td>Moyen (6.5)</td>
                    <td>√âlev√©e</td>
                    <td class="risk-med">√âLEV√â</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>Exposition de Donn√©es Sensibles (DB credentials & Logs)</td>
                    <td>A02: Cryptographic Failures</td>
                    <td>Moyen (5.3)</td>
                    <td>Moyenne</td>
                    <td class="risk-low">MOYEN</td>
                </tr>
                <tr>
                    <td>8</td>
                    <td>Validation d'Entr√©e Insuffisante</td>
                    <td>A03: Injection</td>
                    <td>Moyen (6.5)</td>
                    <td>Moyenne</td>
                    <td class="risk-low">MOYEN</td>
                </tr>
            </tbody>
        </table>

        <h2 id="global-rating">3.2 √âvaluation Globale de S√©curit√©</h2>

        <div class="info-box">
            <h3 style="margin-top: 0; color: var(--accent-color);">Verdict : Non Conforme (Risque Critique)</h3>
            <p>
                L'application bancaire pr√©sente un <strong>Niveau de S√©curit√© TR√àS FAIBLE</strong> en raison de la pr√©sence simultan√©e de trois failles de criticit√© maximale (CRITIQUE) : l'Injection SQL, l'Injection de Code et un Contr√¥le d'Acc√®s d√©faillant.
            </p>
            <p>
                Ces failles permettent une √©l√©vation de privil√®ges instantan√©e, la lecture/modification de toutes les donn√©es bancaires, et la compromission totale du serveur h√¥te. Le risque est syst√©mique et aucune mise en production n'est envisageable sans une refonte compl√®te des m√©canismes de s√©curit√© fondamentaux.
            </p>
        </div>

        <h1 id="details">4. Analyse D√©taill√©e des Vuln√©rabilit√©s</h1>
        
        <p>
            Les vuln√©rabilit√©s sont pr√©sent√©es par ordre de criticit√© d√©croissante, de la faille la plus dangereuse (CRITIQUE) √† la faille MOYENNE. Chaque carte de vuln√©rabilit√© contient l'extrait de code responsable et un sc√©nario d'exploitation document√©.
        </p>
        
        <div class="vuln-card">
            <div class="vuln-header">
                <h3 id="vuln-sqli">4.1 Injection SQL (SQL Injection)</h3>
                <span class="severity-badge sev-critical">Critique (CVSS 9.8)</span>
            </div>
            <div class="vuln-content">
                <h4>Description et Impact</h4>
                <p>
                    La construction des requ√™tes SQL par concat√©nation de cha√Ænes de caract√®res incluant des entr√©es utilisateur expose l'int√©gralit√© du syst√®me √† l'injection SQL. L'impact est <strong>Critique</strong> et m√®ne √† un acc√®s complet √† la base de donn√©es, permettant l'extraction de toutes les donn√©es sensibles et la modification des soldes ou des r√¥les utilisateurs.
                </p>
                <p>
                    <strong>Codes de R√©f√©rence :</strong> OWASP A03:2021 (Injection) / CWE-89 (SQL Injection).
                </p>

                <h4>Code Vuln√©rable (Preuve Statique)</h4>
                <p>Fichier : <code>src/main/java/persistence/users/JdbcUsersPersistence.java</code></p>
                <pre>
public User findUserByEmailAndPwd(String email, String pwd) throws Exception {
    String sql = "SELECT email, name, roles 
                  FROM users 
                  WHERE email = '" + email + "' and password = '" + pwd + "'"; // L. 44-45
}
                </pre>

                <h4>Preuve de Concept (Sc√©nario d'attaque)</h4>
                <p>
                    L'attaquant utilise la charge utile <code>' OR '1'='1</code> dans les champs Email et Password pour contourner le processus d'authentification. La requ√™te devient toujours vraie (<code>... WHERE email = '...' OR '1'='1' ...</code>).
                </p>
                
                <div class="screenshot-box">
                    <img src="https://i.postimg.cc/5056G2y0/login.png" alt="[PLACEHOLDER : Capture d'√©cran du formulaire de login/logout apr√®s un bypass r√©ussi]">
                </div>
                <span class="caption">Figure 2a : Preuve de l'injection SQL permettant un Bypass d'Authentification (Affichage du nom de l'utilisateur ADMIN connect√© sans mot de passe).</span>
                
                <h4>Analyse d'Impact</h4>
                <p><strong>Impact Critique :</strong> Compromission des comptes, vol d'identifiants, acc√®s et manipulation des donn√©es financi√®res.</p>
            </div>
        </div>
        
        <div class="vuln-card">
            <div class="vuln-header">
                <h3 id="vuln-rce">4.2 Injection de Code (RCE via Nashorn)</h3>
                <span class="severity-badge sev-critical">Critique (CVSS 9.1)</span>
            </div>
            <div class="vuln-content">
                <h4>Description et Impact</h4>
                <p>
                    La classe <code>Bank.java</code> utilise le moteur JavaScript <strong>Nashorn</strong> (`ScriptEngine.eval()`) pour √©valuer une expression arithm√©tique fournie par l'utilisateur lors d'une transaction. Cette approche est extr√™mement dangereuse, car elle permet √† un attaquant d'injecter du code JavaScript s'ex√©cutant avec les privil√®ges du serveur (Remote Code Execution ou RCE).
                </p>
                <p>
                    <strong>Codes de R√©f√©rence :</strong> OWASP A03:2021 (Injection) / CWE-94 (Code Injection).
                </p>

                <h4>Code Vuln√©rable (Preuve Statique)</h4>
                <p>Fichier : <code>src/main/java/model/Bank.java</code></p>
                <pre>
public void updateBankAccount(int accountId, String amountExpression) throws Exception {
    ScriptEngineManager manager = new ScriptEngineManager(); // L. 59
    ScriptEngine engine = manager.getEngineByName("js");
    Number result = (Number) engine.eval(amountExpression); // L. 61 - Point de faille
    double amount = result.doubleValue();
    this.persistence.updateBalance(accountId, amount);
}
                </pre>
                
                <h4>Preuve de Concept (Sc√©nario d'attaque)</h4>
                <p>
                    Dans le champ de montant de la transaction, l'attaquant injecte : <code>100; java.lang.Runtime.getRuntime().exec("commande_systeme")</code>.
                </p>
                
                <div class="screenshot-box">
                     <img src="https://i.postimg.cc/L6Ggn7c3/Injection_de_script.png" alt="[PLACEHOLDER : Capture d'√©cran de la console du serveur Tomcat/Eclipse montrant la sortie d'une commande syst√®me (ex: `whoami` ou lecture d'un fichier sensible) ex√©cut√©e par l'expression de montant.]">
                </div>
                <span class="caption">Figure 2b : Ex√©cution de code √† distance (RCE) via l'injection de code JavaScript dans le champ de transaction.</span>
                
                <h4>Analyse d'Impact</h4>
                <p><strong>Impact Critique :</strong> Compromission compl√®te du serveur d'application, exfiltration de donn√©es syst√®me, installation de backdoors.</p>
            </div>
        </div>

        <div class="vuln-card">
            <div class="vuln-header">
                <h3 id="vuln-access">4.3 Contr√¥le d'Acc√®s Insuffisant (Broken Access Control - IDOR)</h3>
                <span class="severity-badge sev-critical">Critique (CVSS 9.1)</span>
            </div>
            <div class="vuln-content">
                <h4>Description et Impact</h4>
                <p>
                    Le contr√¥le d'acc√®s est d√©faillant √† trois niveaux : 1) Le r√¥le utilisateur est stock√© dans un cookie modifiable (`ClientRole`). 2) La <code>TransactionServlet</code> ne v√©rifie ni l'authentification ni l'autorisation (acc√®s direct). 3) Absence de v√©rification de l'appartenance du compte avant les modifications (IDOR, Insecure Direct Object Reference).
                </p>
                <p>
                    <strong>Codes de R√©f√©rence :</strong> OWASP A01:2021 (Broken Access Control) / CWE-639, CWE-284.
                </p>

                <h4>Code Vuln√©rable (Preuve Statique)</h4>
                <p>Fichier : <code>src/main/webapp/index.jsp</code> (D√©pendance au cookie pour l'affichage du menu)</p>
                <pre>
&lt;c:if test="${cookie.ClientRole.value eq 'ADMIN'}"&gt;
    &lt;li&gt;&lt;a href="./view/admin/create_bank_account_form.jsp"&gt;...&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href="./view/admin/view_accounts_form.jsp"&gt;...&lt;/a&gt;&lt;/li&gt;
&lt;/c:if&gt;
                </pre>

                <h4>Preuve de Concept (Sc√©nario d'attaque)</h4>
                <p>
                    Un utilisateur CLIENT (r√¥le "CLIENT") modifie manuellement son cookie <code>ClientRole</code> en "ADMIN" via les outils de d√©veloppeur. Apr√®s rechargement, il acc√®de aux fonctionnalit√©s administrateur.
                </p>
                
                <div class="screenshot-box">
                    <img src="https://i.postimg.cc/DyR48D9g/changement_de_role.png" alt="[PLACEHOLDER : Capture d'√©cran montrant le cookie 'ClientRole' modifi√© en 'ADMIN' dans les outils de dev ET la page d'accueil affichant les liens d'administration.]">
                </div>
                <span class="caption">Figure 2c : √âl√©vation de privil√®ges d√©montr√©e par la modification du cookie ClientRole.</span>
                
                <h4>Analyse d'Impact</h4>
                <p><strong>Impact Critique :</strong> Acc√®s non autoris√© aux fonctionnalit√©s d'administration, cr√©ation de comptes, manipulation des comptes d'autrui, violation du principe du moindre privil√®ge.</p>
            </div>
        </div>

        <div class="vuln-card">
            <div class="vuln-header">
                <h3 id="vuln-auth">4.4 Authentification Faible</h3>
                <span class="severity-badge sev-high">√âlev√© (CVSS 7.5)</span>
            </div>
            <div class="vuln-content">
                <h4>Description et Impact</h4>
                <p>
                    Le stockage des mots de passe en <strong>clair</strong> dans la base de donn√©es est une faille fondamentale (CWE-256). De plus, le m√©canisme de limitation des requ√™tes (anti-force brute) repose sur des cookies modifiables c√¥t√© client (<code>nbRequetes1min</code>, <code>debutDelai</code>), le rendant inefficace.
                </p>
                <p>
                    <strong>Codes de R√©f√©rence :</strong> OWASP A07:2021 (Identification Failures) / CWE-256, CWE-307.
                </p>

                <h4>Code Vuln√©rable (Preuve Statique)</h4>
                <p>Fichier : <code>src/main/java/controllers/AutheticationServlet.java</code> (M√©thode <code>limiteRequetes</code>)</p>
                <pre>
Cookie nbCookie = rechercherCookie(request, "nbRequetes1min"); // L. 77
//...
if (nbCookie != null) { // L. 81
    try { nbRequetes = Integer.parseInt(nbCookie.getValue()); } catch (Exception e) { nbRequetes = 0; }
}
                </pre>

                <h4>Preuve de Concept (Sc√©nario d'attaque)</h4>
                <p>
                    Un attaquant utilise Burp Suite ou un outil similaire pour soumettre des milliers de tentatives de login. En configurant l'outil pour <strong>ignorer ou supprimer les cookies</strong> de rate limiting (<code>nbRequetes1min</code> et <code>debutDelai</code>) √† chaque requ√™te, il contourne la limite de 3 tentatives par minute.
                </p>
                
                
                <h4>Analyse d'Impact</h4>
                <p><strong>Impact √âlev√© :</strong> Permet les attaques par force brute ou par dictionnaire et le vol d'identit√©. Le stockage en clair aggrave la compromission de la base de donn√©es.</p>
            </div>
        </div>

        <div class="vuln-card">
            <div class="vuln-header">
                <h3 id="vuln-xss">4.5 Cross-Site Scripting (XSS Stored & Reflected)</h3>
                <span class="severity-badge sev-medium">Moyen (CVSS 6.1)</span>
            </div>
            <div class="vuln-content">
                <h4>Description et Impact</h4>
                <p>
                    L'application ne proc√®de √† aucun encodage des sorties (absence de la balise JSTL <code>&lt;c:out&gt;</code>) pour les donn√©es r√©cup√©r√©es de la base de donn√©es (XSS Stored) et pour les param√®tres affich√©s via l'URL (XSS Reflected). Cela permet l'injection et l'ex√©cution de scripts malveillants dans le navigateur des victimes.
                </p>
                <p>
                    <strong>Codes de R√©f√©rence :</strong> OWASP A03:2021 (Injection) / CWE-79 (Cross-site Scripting).
                </p>

                <h4>Code Vuln√©rable (Preuve Statique)</h4>
                <p>Fichier : <code>src/main/webapp/view/view_accounts.jsp</code></p>
                <pre>
&lt;tr&gt;
    &lt;!-- NOT ENCODED -&gt; Stored XSS possible --&gt;
    &lt;td&gt;${account.accountId}&lt;/td&gt;
    &lt;td&gt;${account.owner.email}&lt;/td&gt;
    &lt;td&gt;${account.owner.name}&lt;/td&gt; &lt;!-- Point d'injection --&gt;
    &lt;td&gt;${account.balance}&lt;/td&gt;
&lt;/tr&gt;
                </pre>

                <h4>Preuve de Concept (Sc√©nario d'attaque)</h4>
                <p>
                    Un attaquant modifie son nom d'utilisateur en <code>&lt;script&gt;alert('XSS STOCKED PAR CYRIL ET ABDOU')&lt;/script&gt;</code>. Lorsqu'un administrateur consulte la page des comptes (<code>view_accounts.jsp</code>), le script s'ex√©cute, prouvant le XSS Stored.
                </p>
                

                
                <h4>Analyse d'Impact</h4>
                <p><strong>Impact Moyen :</strong> Vol de cookies de session (hijacking de session), ex√©cution d'actions non d√©sir√©es au nom de la victime.</p>
            </div>
        </div>

        <div class="vuln-card">
            <div class="vuln-header">
                <h3 id="vuln-csrf">4.6 Absence de protection CSRF</h3>
                <span class="severity-badge sev-medium">Moyen (CVSS 6.5)</span>
            </div>
            <div class="vuln-content">
                <h4>Description et Impact</h4>
                <p>
                    Aucune des requ√™tes POST critiques (transaction, cr√©ation de compte) ne contient de jeton anti-CSRF (Cross-Site Request Forgery). Cela permet √† un attaquant de forcer un utilisateur authentifi√© √† soumettre des requ√™tes √† son insu (par exemple, un virement bancaire).
                </p>
                <p>
                    <strong>Codes de R√©f√©rence :</strong> OWASP A01:2021 (Broken Access Control) / CWE-352 (CSRF).
                </p>

                <h4>Code Vuln√©rable (Preuve Statique)</h4>
                <p>Fichier : <code>src/main/java/controllers/TransactionServlet.java</code> et <code>src/main/webapp/view/client/do_transaction.jsp</code></p>
                <pre>
// Aucun jeton CSRF n'est inclus ou v√©rifi√© par le TransactionServlet
@Override
protected void doPost(HttpServletRequest req, HttpServletResponse resp) 
throws ServletException, IOException {
    // Aucune v√©rification de token
    int accountId= Integer.parseInt(req.getParameter("pAccountId"));
    String amountExpression = req.getParameter("pAmountExpression");
    // ... ex√©cute la transaction ...
}
                </pre>

                <h4>Preuve de Concept (Sc√©nario d'attaque)</h4>
                <p>
                    Un utilisateur authentifi√© est pi√©g√© pour charger une page web malveillante (contr√¥l√©e par l'attaquant) qui ex√©cute automatiquement une requ√™te POST vers <code>/transaction</code> avec des param√®tres frauduleux, par exemple pour d√©biter son compte de 1000‚Ç¨.
                </p>
                

                
                <h4>Analyse d'Impact</h4>
                <p><strong>Impact Moyen √† √âlev√© :</strong> Transactions frauduleuses ou modifications de donn√©es sans le consentement de l'utilisateur.</p>
            </div>
        </div>

        <div class="vuln-card">
            <div class="vuln-header">
                <h3 id="vuln-others">4.7 Exposition de Donn√©es Sensibles (Configuration)</h3>
                <span class="severity-badge sev-medium">Moyen (CVSS 5.3)</span>
            </div>
            <div class="vuln-content">
                <h4>Description et Impact</h4>
                <p>
                    Les identifiants de connexion √† la base de donn√©es (utilisateur `root`, mot de passe vide ou en clair) sont cod√©s en dur dans la classe <code>JdbcMySQLMainPersistence.java</code>. Toute fuite de code source expose directement les cl√©s du syst√®me. De plus, les requ√™tes SQL (y compris les mots de passe en clair) sont imprim√©es dans la console (`System.out.println`).
                </p>
                <p>
                    <strong>Codes de R√©f√©rence :</strong> OWASP A02:2021 (Cryptographic Failures) / CWE-312 (Cleartext Storage).
                </p>

                <h4>Code Vuln√©rable (Preuve Statique)</h4>
                <p>Fichier : <code>src/main/java/persistence/JdbcMySQLMainPersistence.java</code></p>
                <pre>
private String dbUserName= "root"; // L. 28
private String udbUserPassword="root"; // L. 29
// ...
this.conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/... (dbName...)", 
                                         dbUserName, 
                                         udbUserPassword); // L. 35
                </pre>

                <h4>Preuve de Concept (Sc√©nario d'attaque)</h4>
                <p>
                    Le sc√©nario principal est l'acc√®s aux identifiants via le code source (fuite de code, acc√®s physique au serveur) ou l'analyse des logs (fuite des mots de passe en clair).
                </p>
                

                
                <h4>Analyse d'Impact</h4>
                <p><strong>Impact Moyen :</strong> Facilitation d'autres attaques et violation des donn√©es d'authentification.</p>
            </div>
        </div>

        <div class="vuln-card">
            <div class="vuln-header">
                <h3 id="vuln-input">4.8 Validation d'Entr√©e Insuffisante</h3>
                <span class="severity-badge sev-medium">Moyen (CVSS 6.5)</span>
            </div>
            <div class="vuln-content">
                <h4>Description et Impact</h4>
                <p>
                    L'application suppose que les param√®tres re√ßus sont dans le bon format (e.g., num√©rique ou cha√Æne valide) et proc√®de √† un cast ou une utilisation imm√©diate sans v√©rification de contenu. Cela permet √† un attaquant de provoquer des exceptions (D√©ni de Service Applicatif) ou de contourner les attentes de l'application (facilitation des injections).
                </p>
                <p>
                    <strong>Codes de R√©f√©rence :</strong> OWASP A03:2021 (Injection) / CWE-20 (Improper Input Validation).
                </p>

                <h4>Code Vuln√©rable (Preuve Statique)</h4>
                <p>Fichier : <code>src/main/java/controllers/TransactionServlet.java</code></p>
                <pre>
// Aucune validation de type avant la conversion
int accountId= Integer.parseInt(req.getParameter("pAccountId")); // L. 28
String amountExpression = req.getParameter("pAmountExpression"); // L. 29
                </pre>

                <h4>Preuve de Concept (Sc√©nario d'attaque)</h4>
                <p>
                    L'attaquant envoie la valeur "ABC" pour le param√®tre num√©rique `pAccountId`. La fonction <code>Integer.parseInt()</code> l√®ve une <code>NumberFormatException</code> non g√©r√©e, pouvant afficher une trace de pile compl√®te au client (fuite d'information).
                </p>
                
                
                <h4>Analyse d'Impact</h4>
                <p><strong>Impact Moyen :</strong> Peut entra√Æner un D√©ni de Service cibl√© et faciliter la reconnaissance par l'exposition des traces d'erreurs internes.</p>
            </div>
        </div>

        <h1 id="reco">5. Plan de Rem√©diation et Recommandations</h1>
                
        <div class="info-box">
            <h3 style="margin-top: 0; color: var(--accent-color);">√âtat Global : Non Conforme (Urgence Critique)</h3>
            <p>
                L'application est consid√©r√©e comme <strong>NON S√âCURIS√âE</strong> et ne doit sous aucun pr√©texte √™tre d√©ploy√©e en production. Les actions de rem√©diation doivent √™tre prioris√©es et impl√©ment√©es imm√©diatement.
            </p>
        </div>

        <h2 id="reco-actions">5.1 Actions Imm√©diates (Critical Fixes)</h2>
        <p>
            Ces correctifs ciblent les vuln√©rabilit√©s de criticit√© maximale (CRITIQUE : SQL Injection, Code Injection, Broken Access Control) qui permettent la compromission totale du syst√®me.
        </p>
        <ul>
            <li><strong>Injection SQL (SQLi) :</strong> Remplacer toutes les concat√©nations SQL dans les classes <code>persistence/</code> par des objets <strong>PreparedStatement</strong>.</li>
            <li><strong>Injection de Code (RCE) :</strong> Supprimer l'usage de <code>ScriptEngine.eval()</code>pour le calcul des montants. Utiliser un parser arithm√©tique s√©curis√© ou des fonctions Java natives.</li>
            <li><strong>Contr√¥le d'Acc√®s :</strong> <strong>D√©sactiver la lecture du r√¥le utilisateur via le cookie</strong> (`ClientRole`). Le r√¥le doit √™tre stock√© uniquement c√¥t√© serveur dans la <strong>Session HTTP</strong> et v√©rifi√© dans toutes les Servlets critiques (`TransactionServlet`, `ViewAccountServlet`, etc.).</li>
            <li><strong>Authentification :</strong> Mettre en place d'urgence une fonction de <strong>hachage cryptographique fort</strong> (ex: bcrypt ou Argon2) pour les mots de passe avant stockage en base.</li>
        </ul>

        <h2 id="reco-midterm">5.2 Actions √† Court et Moyen Terme</h2>
        <p>
            Ces actions visent √† am√©liorer la robustesse g√©n√©rale de l'application et √† √©liminer les failles de niveau √âlev√© et Moyen.
        </p>
        <ul>
            <li><strong>XSS :</strong> Encoder syst√©matiquement toutes les sorties g√©n√©r√©es par l'utilisateur dans les pages JSP en utilisant la balise JSTL <code>&lt;c:out value="${variable}"/&gt;</code>.</li>
            <li><strong>Protection CSRF :</strong> Impl√©menter le Synchronizer Token Pattern et v√©rifier la pr√©sence d'un jeton anti-CSRF pour toutes les requ√™tes POST (e.g., <code>/transaction</code>, <code>/auth</code>).</li>
            <li><strong>Input Validation :</strong> Valider et typer strictement toutes les entr√©es utilisateur c√¥t√© serveur (e.g., v√©rifier que <code>pAccountId</code> est bien un entier positif).</li>
            <li><strong>Exposition de Donn√©es :</strong> Retirer les identifiants de connexion √† la base de donn√©es du code source (`JdbcMySQLMainPersistence.java`) et les placer dans des variables d'environnement ou un gestionnaire de secrets.</li>
            <li><strong>Rate Limiting :</strong> Transf√©rer la logique de limitation des requ√™tes (anti-force brute) de l'<code>AutheticationServlet</code> pour qu'elle soit bas√©e sur une logique c√¥t√© serveur (IP source ou Session, et non des cookies clients).</li>
        </ul>

        <h1 id="conclu">6. Conclusion G√©n√©rale</h1>

        <div class="info-box" style="background-color: #ffe6e6; border-left-color: var(--accent-color);">
            <h3 style="margin-top: 0; color: var(--accent-color);">Synth√®se du Niveau de S√©curit√©</h3>
            <p>
                L'audit a r√©v√©l√© des failles critiques (Top 10 OWASP) permettant la compromission totale du serveur et des donn√©es. Le niveau de s√©curit√© global de l'application est jug√© TR√àS FAIBLE.
            </p>
            <p>
                La simultan√©it√© de l'Injection SQL (perte des donn√©es), l'Injection de Code (perte du serveur) et du Contr√¥le d'Acc√®s d√©faillant rend cette application extr√™mement dangereuse et inutilisable en l'√©tat.
            </p>
        </div>

        <h3>Perspectives</h3>
        <p>
            Il est fortement recommand√© de proc√©der √† une refonte compl√®te des m√©canismes de s√©curit√© fondamentaux de l'application. Suite √† l'impl√©mentation de toutes les recommandations de correction, un nouvel audit de s√©curit√© (pentest et revue de code) devra √™tre effectu√© pour valider l'efficacit√© des mesures prises avant toute consid√©ration de mise en production.
        </p>

        <br>
        <hr>

        <p style="font-size: 0.9rem; text-align: right;">
            <strong>Date de l'audit</strong> : Novembre 2024<br>
            <strong>Auditeurs</strong> : Cyril TAKAM & Abdou Khadre DIOP<br>
            <strong>Version de l'application</strong> : tp1-banque-unsecured-v0
        </p>
    </div>
</body>
</html>